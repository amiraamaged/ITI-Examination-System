<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Dashboard - ITI Exam System</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='images/Screenshot_27.png') }}">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo-container">
                    <img src="{{ url_for('static', filename='images/Screenshot_27.png') }}" alt="ITI Logo" class="logo">
                    <div>
                        <div class="institute-name">Information Technology Institute</div>
                        <div class="institute-subtitle">Student Dashboard</div>
                    </div>
                </div>
                <nav>
                    <ul class="nav-menu">
                        <li><a href="{{ url_for('student_dashboard') }}">DASHBOARD</a></li>
                        <li><a href="{{ url_for('logout') }}">LOGOUT</a></li>
                    </ul>
                </nav>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <div class="container">
            <!-- Welcome Section -->
            <!-- Welcome Section -->
<div class="dashboard-welcome">
    <h1>Welcome, {{ student_name }}!</h1>
    <p class="subtitle">Ready to take your exams</p>
    <div class="current-time">
        ðŸ“… Current Time: {{ current_time }}
    </div>
</div>

            <!-- Quick Stats -->
            <div class="stats-container">
                <div class="stat-card">
                    <h3>Available Exams</h3>
                    <p class="stat-number">{{ available_exams|length }}</p>
                </div>
                <div class="stat-card">
                    <h3>Completed Exams</h3>
                    <p class="stat-number">{{ grades|length }}</p>
                </div>
                <div class="stat-card">
                    <h3>Average Score</h3>
                    <p class="stat-number">
                        {% if grades %}
                            {{ (grades|selectattr('Student_Score')|map(attribute='Student_Score')|sum / grades|length)|round(1) if grades else 0 }}
                        {% else %}
                            0
                        {% endif %}
                    </p>
                </div>
            </div>

            <!-- Available Exams Section -->
            <section class="dashboard-section">
                <h2>Available Exams</h2>
                {% if available_exams %}
                <div class="exam-list">
                    {% for exam in available_exams %}
                    <div class="exam-card">
                        <div class="exam-info">
                            <h3>{{ exam.Title }}</h3>
                            <p class="course-name">{{ exam.Course_Name }}</p>
                            <p class="exam-date">ðŸ“… Date: {{ exam.Exam_Date }}</p>
                            <p class="exam-marks">Total Marks: {{ exam.Total_Marks }}</p>
                        </div>
                        <div class="exam-actions">
                            <a href="{{ url_for('take_exam', exam_id=exam.Exam_ID) }}" class="btn">Start Exam</a>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="no-exams">
                    <p>No available exams at the moment.</p>
                </div>
                {% endif %}
            </section>

            <!-- Grades Section -->
<section class="dashboard-section">
    <h2>Your Grades</h2>
    {% if grades %}
    <div class="grades-table">
        <table>
            <thead>
                <tr>
                    <th>Course</th>
                    <th>Exam</th>
                    <th>Your Score</th>
                    <th>Total Marks</th>
                    <th>Percentage</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for grade in grades %}
                <tr>
                    <td>{{ grade.Course_Name }}</td>
                    <td>{{ grade.Exam_Title }}</td>
                    <td>{{ grade.Student_Score }}</td>
                    <td>{{ grade.Total_Marks }}</td>
                    <td>
                        {% if grade.Student_Score is defined and grade.Total_Marks is defined %}
                            {{ ((grade.Student_Score / grade.Total_Marks) * 100)|round(1) }}%
                        {% else %}
                            N/A
                        {% endif %}
                    </td>
                    <td>
                        <span class="status-badge {% if grade.Exam_Status == 'Graded' %}status-graded{% else %}status-pending{% endif %}">
                            {{ grade.Exam_Status or 'Submitted' }}
                        </span>
                    </td>
                    <td>
                        {% if grade.Exam_ID is defined %}
                            <a href="{{ url_for('exam_results', exam_id=grade.Exam_ID) }}" class="btn btn-small">View Results</a>
                        {% else %}
                            <span class="btn btn-small" disabled>No Results</span>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div class="no-grades">
        <p>No exam grades available yet. Take your first exam to see your results here!</p>
    </div>
    {% endif %}
</section>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <p>&copy; 2024 Information Technology Institute. All rights reserved.</p>
        </div>
    </footer>
</body>
</html>